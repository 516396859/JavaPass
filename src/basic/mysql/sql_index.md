---
title: MySQL 索引
icon: file
order: 1
author: Ms.Cheney
date: 2023-10-16
PageView: true
lastUpdated: true
category:
    - MySQL数据库
copyright: false
footer: 赣ICP备2023007682 | 使用 <a href="https://theme-hope.vuejs.press/zh/" target="_blank">VuePress Theme Hope</a> 主题 | MIT 协议, 版权所有 © 2023-Cheney,2018-present Mr.Hope
# 版权声明：本文为JavaPass博主「javapass.cn」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
---

### 0. 聊聊你认识的索引？:star::star::star::two:
索引对查询数据库的效率非常有效，索引是一种用于快速查询和检索数据库的数据结构。本质是一种排好序的数据结构，常用的索引结构有`B`+树、`Hash`、红黑树等。全表扫描，二分查找树，
平衡查找树（`B`树），红黑树，`B`+树；以上只是索引结构，而`MySQL`主要使用哈希表和`B`+树作为索引！

**题评：** 暂无
::: details 点击查看详细答案
待补充
:::

### 1. 索引的优缺？:star::star::star::star::two:
- 优点：大大加快检索速度、唯一性索引可以保证记录唯一性和幂等性；
- 缺点：索引占空间、增删数据时需要维护索引，降低`SQL`执行效率。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 2. 使用索引一定能提高查询性能吗?:star::star::star::star::two:
建立不合理的索引不一定能提高查询性能，例如对性别建立索引，将会导致全表扫描。甚至造成性能下降。

**题评：** 暂无
::: details 点击查看详细答案
待补充
:::

### 3. `MySQL` 索引类型有哪些？:star::star::star::two:
- 哈希索引： 主要是因为 `Hash` 索引不支持顺序和范围查询，顺序查找每次`IO`只能取一条记录；`SELECT` * `FROM` `tb1` `WHERE` `id` < `500`;
- `B`+树：树高度低，叶子节点存储数据或者主键与数据地址；非叶子节点存储索引与地址；

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 4. 聚簇索引与非聚簇索引了解吗？:star::star::star::star::three:
- 非聚簇索引：叶子节点数据域存放的是数据地址，即索引和数据不是放在一个文件中。`MyISAM`存储引擎中，使用的是非聚簇索引。优点是：分开存放更新的代价更小；缺点：会导致二次`IO`读取数据，速度较慢！
- 聚簇索引：叶子节点数据域存放的是数据，索引和数据存放在一个文件中，准确来讲是主键与数据放在一个文件中，二级索引和主键在叶子节点中。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 5. 二级索引了解吗？:star::star::three:
二级索引（`Secondary` `Index`）又称为辅助索引，是因为二级索引的叶子节点存储的数据是主键。也就是说，通过二级索引，可以定位主键的位置。唯一性索引、普通索引等都属于二级索引，二级索引在聚簇索引上容易引起回表。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 6. 覆盖索引与联合索引区别？:star::star::star::three:
覆盖索引与联合索引其实是一回事，都是多个字段组成一个索引，覆盖索引是联合索引的一个特例，需要`select`后面的字段都覆盖在联合索引中。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 7. 什么时候不要建立索引？:star::star::star::three:
- 经常增删改的字段不要建立索引
- 大量重复内容的自动不建立索引
- 表的记录太少了不建立索引

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 8. 如何选择 `MySQL` 的索引？:star::star::star::three:
- 被频繁查询的字段：我们创建索引的字段应该是查询操作非常频繁的字段。
- 被作为条件查询的字段 ：被作为 `WHERE` 条件查询的字段，应该被考虑建立索引。
- 频繁需要排序的字段 ：索引已经排序，这样查询可以利用索引的排序，加快排序查询时间。
- 被频繁更新的字段应该慎重建立索引，虽然索引能带来查询上的效率，但是维护索引的成本也是不小的。 如果一个字段不被经常查询，反而被经常修改，那么就更不应该在这种字段上建立索引了。
- 限制每张表上的索引数量，索引并不是越多越好，建议单张表索引不超过 `5` 个！索引可以提高效率同样可以降低效率。索引可以增加查询效率，但同样也会降低插入和更新的效率，甚至有些情况下会降低查询效率。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 9. 为什么尽可能的考虑建立联合索引而不是单列索引？:star::star::star::star::three:
因为索引是需要占用磁盘空间的，可以简单理解为每个索引都对应着一颗 `B`+树。如果一个表的字段过多，索引过多，那么当这个表的数据达到一个体量后，索引占用的空间也是很多的，且修改索引时，耗费的时间也是较多的。如果是联合索引，多个字段在一个索引上，那么将会节约很大磁盘空间，且修改数据的操作效率也会提升。而且联合索引大概率可以覆盖字段。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 10. 如何避免索引失效？:star::star::star::three:
- 使用了联合索引但未遵守最左匹配原则
- 在`where`索引列上进行计算或者函数操作
- 以 % 开头的`like`查询
- 查询条件中使用`or`，且前后条件其中有一个没有索引

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 11. `SQL`优化经验:star::star::star::four:
- 查询语句无论是使用哪种判断条件 等于、小于、大于， `WHERE` 左侧的条件查询字段不要使用函数或者表达式
- 使用 `EXPLAIN` 命令优化你的 `SELECT` 查询，对于复杂、效率低的 `sql` 语句，我们通常是使用`explain` `sql` 来分析这条 `sql` 语句，这样方便我们分析，进行优化。
- 当你的 `SELECT` 查询语句只需要使用一条记录时，要使用 `LIMIT` `1`，而使用`where`替代
- 不要直接使用 `SELECT` * ，而应该使用具体需要查询的表字段，因为使用 `EXPLAIN` 进行分析时， `SELECT` * 使用的是全表扫描，也就是 `type` = `all` 。
- 避免在 `WHERE` 字句中对字段进行 `NULL` 判断
- 避免在 `WHERE` 中使用 != 或 <> 操作符
- 使用 `BETWEEN` `AND` 替代 `IN`
- 为搜索字段创建索引
- 选择正确的存储引擎，`InnoDB` 、`MyISAM`等
- 使用 `LIKE` %`abc`% 不会走索引，而使用 `LIKE` `abc`% 会走索引
- 对于枚举类型的字段`(`即有固定罗列值的字段`)`，建议使用 `ENUM` 而不是 `VARCHAR` ，如性别、星期、类型、类别等
- 拆分大的 `DELETE` 或 `INSERT` 语句
- 选择合适的字段类型，选择标准是尽可能小、尽可能定长、尽可能使用整数。
- 字段设计尽可能使用 `NOT` `NULL`
- 进行水平切割或者垂直分割

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 12. 大规模数据分页功能的优化如何解决？:star::star::star::five:
相信很多业务都遇到过数据导出，明细展示这方面的需求，`sql`基本上都是先求一个数据的总和然后， `limit` `n`,`m`分页查询，这样的问题就在于，在扫描前面的数据时是不会有性能问题的，当`n`值越大，偏移量越多，扫描的数据就越多，这个时候就会产生问题，一个本来不慢的`sql`就会变成慢`sql`，导致`DB`性能下降。针对这种问题`DBA`都会建议开发将`limit` `n`,`m`改为`id`范围的查询，或者进行业务改造对于一些不必要的场景只展示前几百条，只需要进行一次分页即可。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

### 13. `InnoDB`一次更新事务的流程是怎么样的？:star::star::star::five:
`InnoDB`在更新记录的时候会现在缓存池中查找数据是否在内存，如果不在的话从磁盘读取到内存；然后在修改操作前会记录`undolog`，保证事务的原子性和一致性（这里我还说了一下`undolog`可以用来回滚，`MVCC`机制好像也是用`undo` `log`来做的）；第三步的是执行`update`语句的时候，`InnoDB`会先更新已经读到缓存中的数据，同时将修改操作写入`redo` `log`中；然后提交事务，`InnoDB`将`Redo` `Log`写入磁盘，并且将页状态设置为"脏页"，表示该页修改了但是未刷盘；紧接着把脏页写入磁盘，保证数据的持久性；最后记录`Binlog`。

**题评：** 无
::: details 点击查看详细答案
待补充
:::

